<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inventory Admin Portal </title>

  <style>
    :root{
      --bg:#071021; --panel:#0e1724; --muted:#9aa7b2; --card:#0f1b28; --accent:#2563eb; --accent-2:#7c3aed; --danger:#ef4444; --glass: rgba(255,255,255,0.04);
      --radius:12px; --pad:18px; --shadow: 0 6px 18px rgba(2,6,23,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#061226 0%, #071021 60%);color:#e6eef6}

    /* Layout */
    .wrap{display:grid;grid-template-columns:260px 1fr;gap:24px;min-height:100vh;padding:28px}

    /* Sidebar */
    .sidebar{background:linear-gradient(180deg,var(--panel),#071827);border-radius:16px;padding:22px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:700}
    .brand h1{font-size:1.05rem;margin:0}
    nav{margin-top:14px}
    .nav-btn{display:block;padding:10px 12px;border-radius:10px;color:var(--muted);text-decoration:none;margin-bottom:8px;font-weight:600}
    .nav-btn.active, .nav-btn:hover{background:var(--glass);color:var(--accent)}

    /* Main */
    .main{padding:6px}
    .topbar{display:flex;justify-content:space-between;gap:12px;align-items:center;margin-bottom:18px}
    .search{flex:1;display:flex;gap:12px;align-items:center}
    .search input{flex:1;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.02);color:inherit}
    .user{display:flex;align-items:center;gap:12px}
    .avatar{width:40px;height:40px;border-radius:50%;background:linear-gradient(135deg,#8b5cf6,#06b6d4);display:flex;align-items:center;justify-content:center}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-bottom:18px}
    .card{background:linear-gradient(180deg,var(--card), rgba(12,20,30,0.6));padding:var(--pad);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.02)}
    .card h3{margin:0 0 8px 0;font-size:0.95rem}
    .metric{font-size:1.6rem;font-weight:700}
    .muted{color:var(--muted);font-size:0.85rem}

    /* Table */
    .table-wrap{background:transparent;border-radius:12px;overflow:auto}
    table{width:100%;border-collapse:collapse;min-width:780px}
    th,td{padding:12px 14px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03)}
    th{color:var(--muted);font-size:0.85rem}
    tr:hover td{background:rgba(255,255,255,0.01)}

    .btn{padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .btn.warn{background:var(--danger);color:white}

    /* Modals & forms */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;padding:28px}
    .modal.open{display:flex}
    .modal .panel{width:780px;max-width:100%;background:linear-gradient(180deg,#081426,#071827);border-radius:14px;padding:20px;border:1px solid rgba(255,255,255,0.03)}
    .form-row{display:flex;gap:12px}
    .form-row .col{flex:1}
    label{font-size:0.8rem;color:var(--muted);display:block;margin-bottom:6px}
    input[type=text], input[type=number]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:inherit}

    .low{color:#ffb02e;font-weight:700}
    .small{font-size:0.85rem}

    footer{margin-top:18px;color:var(--muted);font-size:0.85rem}

    /* Responsive */
    @media (max-width:980px){.wrap{grid-template-columns:1fr;}.grid{grid-template-columns:1fr}.sidebar{order:2}}
  </style>
</head>
<body>

  <div class="wrap">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">AI</div>
        <div>
          <h1>Inventory Admin</h1>
          <div class="muted small">Professional edition</div>
        </div>
      </div>

      <nav>
        <a class="nav-btn active" data-target="dashboard">Dashboard</a>
        <a class="nav-btn" data-target="inventory">Inventory</a>
        <a class="nav-btn" data-target="lowstock">Low Stock</a>
        <a class="nav-btn" data-target="importexport">Import / Export</a>
       <!-- <a class="nav-btn" data-target="settings">Settings</a> -->
      </nav>

      <div style="margin-top:20px">
        <button class="btn primary" id="addNowBtn">+ Add Product</button>
      </div>

    </aside>

    <main class="main">
      <div class="topbar">
        <div class="search">
          <input id="globalSearch" placeholder="Search by name or ID, e.g. 'Laptop' or 101" />
          <button class="btn ghost" id="clearSearch">Clear</button>
        </div>
        <div class="user">
          <div class="muted small">Signed in as <strong>Admin</strong></div>
          <div class="avatar">A</div>
        </div>
      </div>

      <!-- DASHBOARD -->
      <section id="dashboard" class="panel-area">
        <div class="grid">
          <div class="card">
            <h3>Total products</h3>
            <div class="metric" id="metricTotal">—</div>
            <div class="muted small">All SKUs stored</div>
          </div>
          <div class="card">
            <h3>Low stock</h3>
            <div class="metric" id="metricLow">—</div>
            <div class="muted small">Products with quantity &lt; 5</div>
          </div>
          <div class="card">
            <h3>Total Inventory Value</h3>
            <div class="metric" id="metricValue">—</div>
            <div class="muted small">Sum of (qty × price)</div>
          </div>
        </div>

        <div class="card">
          <h3>Recent activity</h3>
          <div id="activityLog" class="muted small" style="min-height:48px">No recent activity</div>
        </div>
      </section>

      <!-- INVENTORY -->
      <section id="inventory" class="panel-area" style="display:none">
        <div class="card" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div>
            <h3 style="margin:0">Inventory (sorted by name)</h3>
            <div class="muted small">Click a row to edit, or use actions</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn ghost" id="exportJson">Export JSON</button>
            <button class="btn ghost" id="exportCsv">Export CSV</button>
            <button class="btn primary" id="refreshTable">Refresh</button>
          </div>
        </div>

        <div class="table-wrap card">
          <table id="inventoryTable" aria-label="Inventory table">
            <thead>
              <tr><th>ID</th><th>Name</th><th>Qty</th><th>Price</th><th>Value</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- LOW STOCK -->
      <section id="lowstock" class="panel-area" style="display:none">
        <div class="card">
          <h3>Low stock products</h3>
          <div class="muted small">Listed by insertion time (most recent first)</div>
          <div style="margin-top:12px"><table id="lowTable"><thead><tr><th>ID</th><th>Name</th><th>Qty</th><th>Action</th></tr></thead><tbody></tbody></table></div>
        </div>
      </section>

      <!-- IMPORT / EXPORT -->
      <section id="importexport" class="panel-area" style="display:none">
        <div class="card">
          <h3>Import / Export</h3>
          <div style="display:flex;gap:12px;align-items:center;margin-top:12px">
            <input type="file" id="fileInput" accept=".json,.csv" />
            <button class="btn primary" id="importBtn">Import</button>
            <button class="btn ghost" id="clearAll">Clear All</button>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settings" class="panel-area" style="display:none">
        <div class="card">
          <h3>Settings</h3>
          <div class="muted small">Local-only demo. To plug a real backend, replace persistence with fetch()/XHR to your API.</div>
          <div style="margin-top:12px"><button class="btn ghost" id="downloadSample">Download sample inventory</button></div>
        </div>
      </section>

      <footer .</footer>
    </main>
  </div>

  <!-- MODAL: Add / Edit -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="panel">
      <h3 id="modalTitle">Add product</h3>
      <div style="margin-top:12px">
        <div class="form-row">
          <div class="col"><label>ID</label><input id="fId" type="number" /></div>
          <div class="col"><label>Name</label><input id="fName" type="text" /></div>
        </div>
        <div class="form-row" style="margin-top:12px">
          <div class="col"><label>Quantity</label><input id="fQty" type="number" /></div>
          <div class="col"><label>Price</label><input id="fPrice" type="number" step="0.01" /></div>
        </div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:16px">
          <button class="btn ghost" id="cancelModal">Cancel</button>
          <button class="btn primary" id="saveProduct">Save</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ======================================================
       Core data structures mapped to your C++ design:
         - productMap (Map) => unordered_map
         - BST (insert + inorder) => sorted view by name
         - LinkedList (lowStockList) => simple singly linked list
       Persistence: localStorage (demo). Export/Import available.
    =======================================================*/

    // ------------------ data structures ------------------
    const productMap = new Map(); // id -> product object

    // BST implementation to mirror C++ approach (by name)
    class BSTNode { constructor(product){ this.product = product; this.left = null; this.right = null; } }
    function insertBST(root, product){
      if (!root) return new BSTNode(product);
      if (product.name.localeCompare(root.product.name) < 0) root.left = insertBST(root.left, product);
      else root.right = insertBST(root.right, product);
      return root;
    }
    function inorderBST(root, arr){ if (!root) return; inorderBST(root.left, arr); arr.push(root.product); inorderBST(root.right, arr); }

    // Linked list for low stock (keeps insertion order: newest at head)
    class ListNode{ constructor(product){ this.product = product; this.next = null; } }
    class LinkedList{ constructor(){ this.head = null; }
      add(product){ const n = new ListNode(product); n.next = this.head; this.head = n; }
      toArray(){ const out = []; let cur=this.head; while(cur){ out.push(cur.product); cur = cur.next; } return out; }
    }
    const lowStockList = new LinkedList();

    // ------------------ persistence ------------------
    function saveStore(){
      const arr = [...productMap.entries()];
      localStorage.setItem('inventory_v2', JSON.stringify(arr));
      logActivity('Saved to localStorage');
    }
    function loadStore(){
      const raw = localStorage.getItem('inventory_v2');
      if (!raw) return false;
      try{
        const arr = JSON.parse(raw);
        productMap.clear();
        arr.forEach(([id, obj])=> productMap.set(Number(id), obj));
        rebuildLists();
        return true;
      }catch(e){console.error(e);return false}
    }

    // ------------------ helpers ------------------
    function rebuildLists(){
      // rebuild lowStock list and other derived structures
      lowStockList.head = null;
      for (const p of productMap.values()){
        if (p.quantity < 5) lowStockList.add(p);
      }
    }

    function logActivity(text){
      const el = document.getElementById('activityLog');
      const time = new Date().toLocaleTimeString();
      el.innerHTML = `[${time}] ${text}<br/>` + el.innerHTML;
    }

    // ------------------ CRUD operations ------------------
    function doAddProduct(obj){
      if (productMap.has(obj.id)) throw new Error('ID exists');
      productMap.set(obj.id, obj);
      if (obj.quantity < 5) lowStockList.add(obj);
      saveStore();
      renderAll();
      logActivity(`Added product ${obj.name} (#${obj.id})`);
    }

    function doUpdateProduct(id, changes){
      if (!productMap.has(id)) throw new Error('Not found');
      const p = productMap.get(id);
      Object.assign(p, changes);
      if (p.quantity < 5) lowStockList.add(p);
      saveStore(); renderAll(); logActivity(`Updated ${p.name} (#${p.id})`);
    }

    function doDeleteProduct(id){
      if (!productMap.has(id)) return;
      const p = productMap.get(id);
      productMap.delete(id);
      // Note: linked list may now contain stale pointers — rebuild for correctness
      rebuildLists(); saveStore(); renderAll(); logActivity(`Deleted ${p.name} (#${p.id})`);
    }

    // ------------------ UI Rendering ------------------
    function renderMetrics(){
      const total = productMap.size;
      const low = [...productMap.values()].filter(p=>p.quantity<5).length;
      const value = [...productMap.values()].reduce((s,p)=>s + (p.quantity * Number(p.price||0)),0);
      document.getElementById('metricTotal').textContent = total;
      document.getElementById('metricLow').textContent = low;
      document.getElementById('metricValue').textContent = 'PKR ' + numberWithCommas(value.toFixed(2));
    }

    function numberWithCommas(x){ return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","); }

    function getSortedInventory(){
      // Build BST then inorder
      let root = null;
      for(const p of productMap.values()) root = insertBST(root, p);
      const out=[]; inorderBST(root,out); return out;
    }

    function renderInventoryTable(){
      const tbody = document.querySelector('#inventoryTable tbody'); tbody.innerHTML = '';
      const rows = getSortedInventory();
      for(const p of rows){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${p.id}</td>
                        <td>${escapeHtml(p.name)}</td>
                        <td class="${p.quantity<5?'low':''}">${p.quantity}</td>
                        <td>PKR ${numberWithCommas(Number(p.price).toFixed(2))}</td>
                        <td>PKR ${numberWithCommas((p.quantity * Number(p.price||0)).toFixed(2))}</td>
                        <td>
                          <button class="btn ghost" data-action="edit" data-id="${p.id}">Edit</button>
                          <button class="btn warn" data-action="delete" data-id="${p.id}">Delete</button>
                        </td>`;
        tbody.appendChild(tr);
      }
    }

    function renderLowStock(){
      const tbody = document.querySelector('#lowTable tbody'); tbody.innerHTML = '';
      const arr = lowStockList.toArray();
      if (!arr.length) tbody.innerHTML = '<tr><td colspan="4" class="muted small">All good — no low stock</td></tr>';
      arr.forEach(p=>{
        const tr = document.createElement('tr'); tr.innerHTML = `<td>${p.id}</td><td>${escapeHtml(p.name)}</td><td class="low">${p.quantity}</td><td><button class="btn primary" data-action="edit" data-id="${p.id}">Restock</button></td>`; tbody.appendChild(tr);
      });
    }

    function escapeHtml(s){ return (s+'').replace(/[&<>\"]/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[c])); }

    function renderAll(){ renderMetrics(); renderInventoryTable(); renderLowStock(); }

    // ------------------ UI wiring ------------------
    document.querySelectorAll('.nav-btn').forEach(a=>a.addEventListener('click',e=>{
      document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
      a.classList.add('active');
      document.querySelectorAll('.panel-area').forEach(s=>s.style.display='none');
      document.getElementById(a.dataset.target).style.display = 'block';
    }));

    // modal controls
    const modal = document.getElementById('modal');
    document.getElementById('addNowBtn').addEventListener('click',()=>openModal('add'));
    document.getElementById('cancelModal').addEventListener('click',()=>closeModal());

    function openModal(mode, product){
      modal.classList.add('open'); document.getElementById('modalTitle').textContent = mode==='add' ? 'Add product' : 'Edit product';
      if (mode==='edit' && product){ document.getElementById('fId').value = product.id; document.getElementById('fId').disabled = true; document.getElementById('fName').value=product.name; document.getElementById('fQty').value=product.quantity; document.getElementById('fPrice').value=product.price; }
      if (mode==='add'){ document.getElementById('fId').disabled=false; document.getElementById('fId').value=''; document.getElementById('fName').value=''; document.getElementById('fQty').value=''; document.getElementById('fPrice').value=''; }
      modal.dataset.mode = mode;
    }
    function closeModal(){ modal.classList.remove('open'); }

    document.getElementById('saveProduct').addEventListener('click', ()=>{
      const id = Number(document.getElementById('fId').value);
      const name = document.getElementById('fName').value.trim();
      const qty = Number(document.getElementById('fQty').value);
      const price = Number(document.getElementById('fPrice').value);
      if (!id || !name || Number.isNaN(qty) || Number.isNaN(price)) return alert('Please fill all fields correctly');
      try{
        if (modal.dataset.mode==='add') doAddProduct({id,name,quantity:qty,price});
        else doUpdateProduct(id, {name, quantity: qty, price});
        closeModal();
      }catch(e){ alert(e.message); }
    });

    // table actions
    document.getElementById('inventoryTable').addEventListener('click', (e)=>{
      const btn = e.target.closest('button'); if(!btn) return; const id = Number(btn.dataset.id);
      if (btn.dataset.action==='edit') openModal('edit', productMap.get(id));
      else if (btn.dataset.action==='delete'){
        if (confirm('Delete product #' + id + '?')) doDeleteProduct(id);
      }
    });

    // lowstock actions
    document.getElementById('lowTable').addEventListener('click', (e)=>{ const btn = e.target.closest('button'); if(!btn) return; const id = Number(btn.dataset.id); openModal('edit', productMap.get(id)); });

    // export/import
    document.getElementById('exportJson').addEventListener('click', ()=>{
      const data = JSON.stringify([...productMap.entries()], null, 2);
      downloadFile('inventory.json', data, 'application/json');
      logActivity('Exported JSON');
    });
    document.getElementById('exportCsv').addEventListener('click', ()=>{
      const rows = [['id','name','quantity','price']];
      for (const p of productMap.values()) rows.push([p.id,p.name,p.quantity,p.price]);
      const csv = rows.map(r=>r.map(String).map(cell=>`"${cell.replace(/"/g,'""')}"`).join(',')).join('\n');
      downloadFile('inventory.csv', csv, 'text/csv'); logActivity('Exported CSV');
    });

    function downloadFile(filename, content, type){ const a=document.createElement('a'); const blob = new Blob([content], {type}); a.href = URL.createObjectURL(blob); a.download = filename; a.click(); URL.revokeObjectURL(a.href); }

    // import
    document.getElementById('importBtn').addEventListener('click', ()=>{
      const file = document.getElementById('fileInput').files[0]; if(!file) return alert('Choose a file');
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          if (file.name.endsWith('.json')){
            const arr = JSON.parse(reader.result);
            // accept two shapes: [[id,obj],...] or [{id,name,quantity,price},...]
            if (Array.isArray(arr) && Array.isArray(arr[0])){
              arr.forEach(([id,obj])=> productMap.set(Number(id), obj));
            } else if (Array.isArray(arr) && typeof arr[0]==='object'){
              arr.forEach(obj=> productMap.set(Number(obj.id), obj));
            } else throw new Error('Unsupported JSON format');
          } else {
            // CSV basic
            const text = reader.result; const lines = text.split(/\r?\n/).filter(Boolean);
            const [hdr,...rest] = lines.map(l=>l.split(/,|\t/).map(c=>c.replace(/^\"|\"$/g,'').trim()));
            for (const r of rest){ const obj = {id:Number(r[0]), name:r[1], quantity:Number(r[2]), price:Number(r[3])}; productMap.set(obj.id, obj); }
          }
          rebuildLists(); saveStore(); renderAll(); logActivity('Imported data'); alert('Import complete');
        }catch(err){ alert('Import failed: ' + err.message); }
      };
      reader.readAsText(file);
    });

    // clear all
    document.getElementById('clearAll').addEventListener('click', ()=>{
      if (!confirm('This will remove ALL local data. Continue?')) return; productMap.clear(); rebuildLists(); saveStore(); renderAll(); logActivity('Cleared all data');
    });

    // sample download
    document.getElementById('downloadSample').addEventListener('click', ()=>{
      const sample = [{id:101,name:'Laptop',quantity:10,price:120000},{id:102,name:'Mouse',quantity:3,price:1500},{id:103,name:'Keyboard',quantity:2,price:3000}];
      downloadFile('sample_inventory.json', JSON.stringify(sample,null,2),'application/json');
    });

    // small helpers
    document.getElementById('refreshTable').addEventListener('click', ()=>renderAll());
    document.getElementById('globalSearch').addEventListener('input', (e)=>{
      const q = e.target.value.trim().toLowerCase(); if (!q) return renderAll();
      // filter inventory table directly
      const tbody = document.querySelector('#inventoryTable tbody'); tbody.innerHTML='';
      for (const p of getSortedInventory()){
        if (String(p.id).includes(q) || p.name.toLowerCase().includes(q)){
          const tr = document.createElement('tr'); tr.innerHTML = `<td>${p.id}</td><td>${escapeHtml(p.name)}</td><td class="${p.quantity<5?'low':''}">${p.quantity}</td><td>PKR ${numberWithCommas(Number(p.price).toFixed(2))}</td><td>PKR ${numberWithCommas((p.quantity * Number(p.price||0)).toFixed(2))}</td><td><button class="btn ghost" data-action="edit" data-id="${p.id}">Edit</button> <button class="btn warn" data-action="delete" data-id="${p.id}">Delete</button></td>`; tbody.appendChild(tr);
        }
      }
    });
    document.getElementById('clearSearch').addEventListener('click', ()=>{ document.getElementById('globalSearch').value=''; renderAll(); });

    // attach delegated listener for lowstock/edit restock
    // initial load
    if (!loadStore()){
      // demo seed
      productMap.set(101,{id:101,name:'Laptop',quantity:10,price:120000});
      productMap.set(102,{id:102,name:'Mouse',quantity:3,price:1500});
      productMap.set(103,{id:103,name:'Keyboard',quantity:2,price:3000});
      rebuildLists(); saveStore();
    }
    renderAll();

    // small utility: click outside modal to close
    modal.addEventListener('click', (e)=>{ if (e.target===modal) closeModal(); });

    // escape key closes modal
    window.addEventListener('keydown', (e)=>{ if (e.key==='Escape'){ closeModal(); } });

    // helper to expose actions programmatically if examiner asks in viva
    window._internal = { productMap, doAddProduct, doUpdateProduct, doDeleteProduct, rebuildLists };
  </script>
</body>
</html>
